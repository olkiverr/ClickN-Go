
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - ClickN'Go</title>
    <link rel="icon" href="/img/logo.png" type="image/png">
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body data-theme="dark">
    <%- include('partials/header') %>
    <main class="section-container">
        <h2 class="section-title">Your Shopping Cart</h2>
        <% if (items.length === 0) { %>
            <p>Your cart is empty.</p>
        <% } else { %>
            <div class="products-grid" style="grid-template-columns: 1fr;">
                <% items.forEach(item => { %>
                    <div class="product-card" style="display: flex; align-items: center; text-align: left;">
                        <img src="<%= item.product.image_url %>" alt="<%= item.product.name %>" style="width: 100px; height: 100px; object-fit: contain; margin-right: 1.5rem;">
                        <div class="product-info" style="flex-grow: 1;">
                            <h3 class="product-title"><%= item.product.name %></h3>
                            <p>Quantity: <%= item.quantity %></p>
                            <p>Unit Price: $<%= item.product.price %></p>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <p class="price-current">Total: $<%= item.itemTotal.toFixed(2) %></p>
                            <a href="/cart/remove/<%= item.productId %>" class="btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Remove</a>
                        </div>
                    </div>
                <% }) %>
            </div>
            <div class="cart-summary" style="text-align: right; margin-top: 2rem;">
                <div class="cart-total" style="font-size: 1.2rem;">
                    <strong>Subtotal: $<%= totalPrice.toFixed(2) %></strong>
                </div>

                <% if (promo) { %>
                    <div class="cart-discount" style="color: green; font-size: 1.2rem;">
                        <strong>Discount (<%= promo.code %>): -$<%= discountAmount.toFixed(2) %></strong>
                    </div>
                <% } %>

                <div class="cart-final-price" style="font-size: 1.8rem; font-weight: bold; margin-top: 0.5rem;">
                    <strong>Total: $<%= finalPrice.toFixed(2) %></strong>
                </div>
            </div>

            <div class="promo-section" style="text-align: right; margin-top: 1.5rem;">
                <form action="/cart/apply-promo" method="POST">
                    <input type="text" name="promoCode" placeholder="Enter Promo Code" style="padding: 0.5rem;">
                    <button type="submit" class="btn-secondary">Apply</button>
                </form>
                <% if (promoError) { %>
                    <p style="color: red; margin-top: 0.5rem;"><%= promoError %></p>
                <% } %>
                <% if (promoSuccess) { %>
                    <p style="color: green; margin-top: 0.5rem;"><%= promoSuccess %></p>
                <% } %>
            </div>

            <div style="text-align: right; margin-top: 1rem;">
                <a href="/cart/checkout" class="btn-primary" style="padding: 1rem 2rem; font-size: 1.1rem;">Proceed to Checkout</a>
            </div>
        <% } %>
    </main>
    <script src="/js/main.js"></script>
</body>
</html>
